<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" "http://mybatis.org/dtd/mybatis-3-mapper.dtd" >

<mapper namespace="com.moxos.uab.mybatis.dao.ProgramaAnaliticoDao">

    <resultMap id="map_listar_caratula" type="com.moxos.uab.mybatis.entity.ProgramaAnalitico">
        <result property="id_persona" column="id_persona"/>
        <result property="dip" column="dip"/>
        <result property="nombres" column="nombres"/>
        <result property="paterno" column="paterno"/>
        <result property="materno" column="materno"/>
        <result property="id_docente" column="id_docente"/>
        <result property="categoria" column="categoria"/>
        <result property="facultad" column="facultad"/>
        <result property="departamento" column="departamento"/>
        <result property="id_materia" column="id_materia"/>
        <result property="sigla" column="sigla"/>
        <result property="materia" column="materia"/>
        <result property="hrs_teoricas" column="hrs_teoricas"/>
        <result property="hrs_practicas" column="hrs_practicas"/>
        <result property="hrs_periodo" column="hrs_periodo"/>
        <result property="creditos" column="creditos"/>
        <result property="id_tipo_materia" column="id_tipo_materia"/>
        <result property="tipo" column="tipo"/>
        <result property="ciclo_materia" column="ciclo_materia"/>
        <result property="id_plan" column="id_plan"/>
    </resultMap>
    <select id="GetListarDatosCaratula" resultMap="map_listar_caratula">
        SELECT d.id_persona::integer, p.dip::text, p.nombres::text, p.paterno::text, p.materno::text, p.celular::text, p.correo::text, d.id_docente::integer, d.categoria::text, f.facultad::text, fd.departamento::text, dct.gestion::text, dct.periodo::text, am.area::text, mtm.tipo_materia::text, m.id_materia::integer, m.sigla::text, m.materia::text, m.hrs_teoricas::integer, m.hrs_practicas::integer, m.hrs_periodo::integer, m.creditos,
               m.id_tipo_materia::integer , am.tipo,
               am.ciclo_materia,
               mtp.id_plan
        FROM docentes d
                 inner join dct_asignaciones dct on d.id_docente = dct.id_docente
                 inner join personas p on p.id_persona = d.id_persona
                 inner join materias m on dct.id_materia = m.id_materia
                 inner join fcl_departamentos fd on dct.id_departamento = fd.id_departamento
                 inner join facultades f on fd.id_facultad = f.id_facultad
                 inner join areas_materias am on am.id_materia = m.id_materia
                 inner join mtr_tipos_materias mtm on mtm.id_tipo_materia = m.id_tipo_materia
                 inner join tipos_asignaciones tp on tp.id_tipo_asignacion = dct.id_tipo_asignacion
                 inner join tipos_docentes td on td.id_tipo_docente = dct.id_tipo_docente
                 LEFT join persona_kardex pk on p.id_persona = pk.id_persona
                 inner join mtr_planes mtp on mtp.id_materia = m.id_materia
        WHERE dct.id_asignacion = #{id_asignacion}
          and mtp.id_materia_ant = m.id_materia
          and dct.id_tipo_evaluacion = 1
          and am.id_estado = 'A';
    </select>
    <resultMap id="map_listar_materia_programa_analitico" type="com.moxos.uab.mybatis.entity.ProgramaAnalitico">
        <result property="facultad" column="facultad"/>
        <result property="departamento" column="departamento"/>
        <result property="id_persona" column="id_persona"/>
        <result property="grado_academico" column="grado_academico"/>
        <result property="tipo_materia" column="tipo_materia"/>
        <result property="ciclo_materia" column="ciclo_materia"/>
        <result property="nivel_academico" column="nivel_academico"/>
        <result property="area" column="area"/>
        <result property="materia" column="materia"/>
        <result property="sigla" column="sigla"/>
        <result property="clasificacion_asignatura" column="clasificacion_asignatura"/>
        <result property="hrs_teoricas" column="hrs_teoricas"/>
        <result property="hrs_practicas" column="hrs_practicas"/>
        <result property="Turno" column="Turno"/>
        <result property="gestion" column="gestion"/>
        <result property="periodo" column="periodo"/>
        <result property="nombres" column="nombres"/>
        <result property="paterno" column="paterno"/>
        <result property="materno" column="materno"/>
        <result property="tipo_categoria" column="tipo_categoria"/>
        <result property="tipo_docente" column="tipo_docente"/>
        <result property="modalidad_deingreso" column="modalidad_deingreso"/>
        <result property="creditos" column="creditos"/>
        <result property="telefonocelular" column="telefonocelular"/>
        <result property="numerodocumento" column="numerodocumento"/>
        <result property="categoria" column="categoria"/>
        <result property="correo" column="correo"/>
        <result property="id_docente" column="id_docente"/>
        <result property="id_materia" column="id_materia"/>
        <result property="id_tipo_materia" column="id_tipo_materia"/>
        <result property="id_plan" column="id_plan"/>
        <result property="id_programa" column="id_programa"/>
        <result property="id_departamento" column="id_departamento"/>
        <result property="id_grupo" column="id_grupo"/>
        <result property="id_mencion" column="id_mencion"/>
        <result property="id_persona" column="id_persona"/>
    </resultMap>
    <select id="getListarInformeProgramaAnalitico" resultMap="map_listar_materia_programa_analitico">
        SELECT f.facultad,
               fd.departamento::text, graca.grado_academico,
               mtm.tipo_materia::text, am.ciclo_materia,
               mtp.nivel_academico,
               am.area::text, m.materia::text, m.sigla::text, am.tipo as clasificacion_asignatura,
               m.hrs_teoricas::integer, m.hrs_practicas::integer, flc_pgr.Turno,
               dct.gestion::text, dct.periodo::text, p.nombres::text, p.paterno::text, p.materno::text, upper(CASE
                                                                                                                  WHEN td.id_tipo_docente = 3 OR td.id_tipo_docente = 4
                                                                                                                      THEN 'Docente honorífico'
                                                                                                                  WHEN td.id_tipo_docente = 2 OR td.id_tipo_docente = 5
                                                                                                                      THEN 'Docente extraordinario'
                                                                                                                  WHEN td.id_tipo_docente = 6 OR td.id_tipo_docente = 1
                                                                                                                      THEN 'Docente ordinario'
            END) as tipo_categoria,
               upper(td.tipo_docente) as tipo_docente,
               CASE
                   WHEN td.id_tipo_docente = 3 OR td.id_tipo_docente = 4 OR td.id_tipo_docente = 5 OR
                        td.id_tipo_docente = 5 THEN
                       'DESIGNACION DIRECTA'
                   WHEN td.id_tipo_docente = 2 THEN 'EXAMEN DE COMPETENCIA'
                   WHEN td.id_tipo_docente = 1 THEN 'CONCURSO DE MERITO'
                   END                as modalidad_deingreso,
               m.creditos,
               telefonocelular,
               numerodocumento,
               p.correo::text, d.categoria::text, d.id_docente::integer, m.id_materia::integer, m.id_tipo_materia::integer , mtp.id_plan,
               flc_pgr.id_programa,
               dct.id_departamento,
               dct.id_grupo,
               mtp.id_mencion,
               p.id_persona,
               pgraca.horas
        FROM docentes d
                 inner join dct_asignaciones dct on d.id_docente = dct.id_docente
                 inner join personas p on p.id_persona = d.id_persona
                 inner join materias m on dct.id_materia = m.id_materia
                 inner join fcl_departamentos fd on dct.id_departamento = fd.id_departamento
                 inner join facultades f on fd.id_facultad = f.id_facultad
                 inner join areas_materias am on am.id_materia = m.id_materia
                 inner join mtr_tipos_materias mtm on mtm.id_tipo_materia = m.id_tipo_materia
                 inner join tipos_asignaciones tp on tp.id_tipo_asignacion = dct.id_tipo_asignacion
                 inner join tipos_docentes td on td.id_tipo_docente = dct.id_tipo_docente
                 LEFT join persona_kardex pk on p.id_persona = pk.id_persona
                 inner join mtr_planes mtp on mtp.id_materia = m.id_materia
                 inner join fcl_departamentos_programas dep_pgr on dct.id_departamento = dep_pgr.id_departamento
                 inner join fcl_programas flc_pgr on flc_pgr.id_programa = dep_pgr.id_programa
                 inner join prg_grados_academicos pgraca on flc_pgr.id_programa = pgraca.id_programa
                 inner join grados_academicos graca on graca.id_grado_academico = pgraca.id_grado_academico
        WHERE dct.id_asignacion = #{id_asignacion}
          and pgraca.id_estado = 'A'
          and pgraca.id_plan = mtp.id_plan
          and mtp.id_materia_ant = m.id_materia
          and dct.id_tipo_evaluacion = 1
          and am.id_estado = 'A' LIMIT 1;
    </select>
    <resultMap id="map_listar_materia" type="com.moxos.uab.mybatis.entity.ProgramaAnalitico">
        <result property="id_persona" column="id_persona"/>
        <result property="dip" column="dip"/>
        <result property="nombres" column="nombres"/>
        <result property="paterno" column="paterno"/>
        <result property="materno" column="materno"/>
        <result property="celular" column="celular"/>
        <result property="correo" column="correo"/>
        <result property="id_docente" column="id_docente"/>
        <result property="categoria" column="categoria"/>
        <result property="facultad" column="facultad"/>
        <result property="departamento" column="departamento"/>
        <result property="gestion" column="gestion"/>
        <result property="periodo" column="periodo"/>
        <result property="area" column="area"/>
        <result property="tipo_materia" column="tipo_materia"/>
        <result property="id_materia" column="id_materia"/>
        <result property="sigla" column="sigla"/>
        <result property="materia" column="materia"/>
        <result property="hrs_teoricas" column="hrs_teoricas"/>
        <result property="hrs_practicas" column="hrs_practicas"/>
        <result property="hrs_periodo" column="hrs_periodo"/>
        <result property="creditos" column="creditos"/>
        <result property="id_tipo_materia" column="id_tipo_materia"/>
        <result property="tipo" column="tipo"/>
        <result property="ciclo_materia" column="ciclo_materia"/>
        <result property="tipo_asignacion" column="tipo_asignacion"/>
        <result property="tipo_categoria" column="tipo_categoria"/>
        <result property="tipo_docente" column="tipo_docente"/>
        <result property="telefonocelular" column="telefonocelular"/>
        <result property="nivel_academico" column="nivel_academico"/>
    </resultMap>

    <select id="GetListarMateriaProgramaAnalitico" resultMap="map_listar_materia">
        SELECT d.id_persona::integer, p.dip::text, p.nombres::text, p.paterno::text, p.materno::text, p.celular::text, p.correo::text, d.id_docente::integer, d.categoria::text, f.facultad::text, fd.departamento::text, dct.gestion::text, dct.periodo::text, am.area::text, mtm.tipo_materia::text, m.id_materia::integer, m.sigla::text, m.materia::text, m.hrs_teoricas::integer, m.hrs_practicas::integer, m.hrs_periodo::integer, m.creditos,
               m.id_tipo_materia::integer , am.tipo,
               am.ciclo_materia,
               upper(tp.tipo_asignacion) as tipo_asignacion,
               upper(CASE
                         WHEN td.id_tipo_docente = 3 OR td.id_tipo_docente = 4 THEN 'Docentes honoríficos'
                         WHEN td.id_tipo_docente = 2 OR td.id_tipo_docente = 5 THEN 'Docentes extraordinarios'
                         WHEN td.id_tipo_docente = 6 OR td.id_tipo_docente = 1 THEN 'Docentes ordinarios'
                   END)                  as tipo_categoria,
               upper(td.tipo_docente)    as tipo_docente,
               telefonocelular,
               mtp.nivel_academico
        FROM docentes d
                 inner join dct_asignaciones dct on d.id_docente = dct.id_docente
                 inner join personas p on p.id_persona = d.id_persona
                 inner join materias m on dct.id_materia = m.id_materia
                 inner join fcl_departamentos fd on dct.id_departamento = fd.id_departamento
                 inner join facultades f on fd.id_facultad = f.id_facultad
                 inner join areas_materias am on am.id_materia = m.id_materia
                 inner join mtr_tipos_materias mtm on mtm.id_tipo_materia = m.id_tipo_materia
                 inner join tipos_asignaciones tp on tp.id_tipo_asignacion = dct.id_tipo_asignacion
                 inner join tipos_docentes td on td.id_tipo_docente = dct.id_tipo_docente
                 LEFT join persona_kardex pk on p.id_persona = pk.id_persona
                 inner join mtr_planes mtp on mtp.id_materia = m.id_materia
        WHERE dct.id_asignacion = #{id_asignacion}
          and mtp.id_materia_ant = m.id_materia
          and dct.id_tipo_evaluacion = 1
          and am.id_estado = 'A';
    </select>
    <resultMap id="idListarPrerequisitoMateria" type="com.moxos.uab.mybatis.entity.ProgramaAnalitico">
        <result property="materia" column="materia"/>
        <result property="sigla" column="sigla"/>
        <result property="nivel_academico" column="nivel_academico"/>
    </resultMap>
    <select id="GetListarPrerequisitoMateria" resultMap="idListarPrerequisitoMateria">
        SELECT nivel_academico, sigla, materia
        FROM mi_listar_materias_requisitos(#{id_programa}, #{id_plan}, #{id_materia}, #{id_mencion}, #{id_tipo_grado})
            AS (id_mtr_plan integer, nivel_academico dentero, id_materia_ant dentero, id_materia integer, sigla dtexto, materia dtexto)

    </select>

    <select id="PermitirRegistroPrograma" resultType="java.lang.Integer">
        SELECT *
        FROM mi_dct_listar_materia_permitir_prg_analitico(#{id_materia}, #{id_plan}, #{id_grupo})
    </select>
    <select id="getIdProgramaAnalitico" resultType="java.lang.Integer">
        SELECT id_dct_programa_analitico
        from dct_programa_analitico
        where id_estado = 'A'
          and id_docente = #{id_docente}
          and id_asignacion = #{id_asignacion}
          and id_materia = #{id_materia}
          and id_plan = #{id_plan}
          and id_grupo = #{id_grupo}
          and gestion = #{gestion}
          and periodo = #{periodo} limit 1
    </select>

    <select id="ActualizarProgramaAnalitico" resultType="java.lang.Integer">
        select *
        from
            mi_dct_update_programa_analitico(#{id_dct_programa_analitico}, #{marco_referencial}, #{justificacion},
                                             #{propositos}, #{objetivo_desarrollador}, #{objetivo_educativo},
                                             #{metodos_estrategias}, #{recursos}, #{sistema_evaluacion}, #{id_estado},
                                             #{nro_resolucion}, #{observacion}, #{sistema_evaluacion_criterios});
    </select>
    <select id="insertProgramaAnalitico" resultType="java.lang.Integer">
        select *
        from mi_dct_registrar_programa_analitico_copia(#{id_docente}, #{id_persona}, #{id_asignacion},
                                                       #{marco_referencial}, #{justificacion}, #{propositos},
                                                       #{objetivo_desarrollador}, #{objetivo_educativo},
                                                       #{metodos_estrategias}, #{recursos}, #{sistema_evaluacion},
                                                       #{id_estado}, #{ult_usuario}, #{id_plan}, #{id_grupo},
                                                       #{id_materia}, #{nro_resolucion}, #{observacion}, #{periodo},
                                                       #{gestion},
                                                       #{sistema_evaluacion_criterios});
    </select>
    <select id="RegistrarProgromaAnalitico" resultType="java.lang.Integer">
        select *
        from mi_dct_registrar_programa_analitico
            (#{id_docente}, #{id_persona}, #{id_asignacion}, #{id_plan}, #{id_grupo}, #{id_materia}, #{nro_resolucion},
             #{observacion}, #{periodo}, #{gestion}, #{sistema_evaluacion_criterios});
    </select>

    <select id="GetNivelAcademico" resultType="java.lang.Integer">
        SELECT mtr_planes.nivel_academico
        FROM public.mtr_planes
        WHERE mtr_planes.id_materia = #{id_materia}
          AND mtr_planes.id_materia_ant = #{id_materia}
          AND mtr_planes.id_plan = #{id_plan}
          AND mtr_planes.id_plan_ant = #{id_plan};
    </select>

    <resultMap id="map_listar_programa_analitico" type="com.moxos.uab.mybatis.entity.ProgramaAnalitico">
        <result property="id_dct_programa_analitico" column="id_dct_programa_analitico"/>
        <result property="id_docente" column="id_docente"/>
        <result property="id_persona" column="id_persona"/>
        <result property="id_asignacion" column="id_asignacion"/>
        <result property="marco_referencial" column="marco_referencial"/>
        <result property="justificacion" column="justificacion"/>
        <result property="propositos" column="propositos"/>
        <result property="objetivo_desarrollador" column="objetivo_desarrollador"/>
        <result property="objetivo_educativo" column="objetivo_educativo"/>
        <result property="metodos_estrategias" column="metodos_estrategias"/>
        <result property="recursos" column="recursos"/>
        <result property="sistema_evaluacion" column="sistema_evaluacion"/>
        <result property="id_estado" column="id_estado"/>
        <result property="fec_registro" column="fec_registro"/>
        <result property="fec_modificacion" column="fec_modificacion"/>
        <result property="ult_usuario" column="ult_usuario"/>
        <result property="id_plan" column="id_plan"/>
        <result property="id_grupo" column="id_grupo"/>
        <result property="id_materia" column="id_materia"/>
        <result property="nro_resolucion" column="nro_resolucion"/>
        <result property="observacion" column="observacion"/>
        <result property="periodo" column="periodo"/>
        <result property="gestion" column="gestion"/>
        <result property="sistema_evaluacion_criterios" column="sistema_evaluacion_criterios"/>
    </resultMap>
    <select id="GetListaProgramaanalitico" resultMap="map_listar_programa_analitico">
        select *
        from dct_programa_analitico
        where id_estado = 'A'
          and id_docente = #{id_docente}
          and id_materia = #{id_materia}
          and id_plan = #{id_plan}
          and id_grupo = #{id_grupo}
          and periodo = #{periodo}
          and gestion = #{gestion};
    </select>
    <select id="GetProgramaanaliticoDetalle" resultMap="map_listar_programa_analitico">
        select *
        from dct_programa_analitico
        where id_docente = #{id_docente}
          and id_materia = #{id_materia}
          and id_plan = #{id_plan}
          and id_grupo = #{id_grupo}
          and periodo = #{periodo}
          and gestion = #{gestion};
    </select>
    <select id="getDetalleProgramaAnalitico" resultMap="map_listar_programa_analitico">
        select *
        from dct_programa_analitico
        where id_dct_programa_analitico = #{id_dct_programa_analitico};
    </select>
    <resultMap id="map_caratula" type="com.moxos.uab.mybatis.entity.ProgramaAnalitico">
        <result property="facultad" column="facultad"/>
        <result property="departamento" column="departamento"/>
        <result property="materia" column="materia"/>
        <result property="titulo" column="titulo"/>
        <result property="nombres" column="nombres"/>
        <result property="paterno" column="paterno"/>
        <result property="materno" column="materno"/>
        <result property="fec_modificacion" column="fec_modificacion"/>
    </resultMap>

    <select id="GetDatosCaratula" resultMap="map_caratula">
        SELECT f.facultad,
               de.departamento,
               m.materia,
               pa.nro_resolucion AS titulo,
               p.nombres,
               p.paterno,
               p.materno,
               pa.fec_modificacion,
               pa.gestion,
               pa.periodo
        FROM dct_programa_analitico pa,
             materias m,
             fcl_departamentos de,
             facultades f,
             docentes d,
             personas p
        WHERE m.id_materia = pa.id_materia
          AND de.id_departamento = m.id_departamento
          AND f.id_facultad = de.id_facultad
          AND d.id_docente = pa.id_docente
          AND p.id_persona = d.id_persona
          and pa.id_dct_programa_analitico = #{id_dct_programa_analitico};
    </select>

    <select id="getProgramaanalitico" resultMap="map_listar_programa_analitico">
        SELECT id_dct_programa_analitico,
               id_docente,
               id_persona,
               id_asignacion,
               marco_referencial,
               justificacion,
               propositos,
               objetivo_desarrollador,
               objetivo_educativo,
               metodos_estrategias,
               recursos,
               sistema_evaluacion,
               id_estado,
               fec_registro,
               fec_modificacion,
               ult_usuario,
               id_plan,
               id_grupo,
               id_materia,
               nro_resolucion,
               observacion,
               periodo,
               gestion,
               sistema_evaluacion_criterios
        FROM dct_programa_analitico
        where id_dct_programa_analitico = #{id_dct_programa_analitico};
    </select>
    <!-- BIBLIOGRAFIA -->
    <insert id="copyBibliografia">
        INSERT INTO public.prg_a_bibliografia(id_dct_programa_analitico, tipo_referncia, autor, anio, fecha_publicacion,
                                              titulo, edicion, titulo_documento, lugar, editorial, volumen, numero,
                                              paginas, fecha_consulta, url, ubicacion, id_estado, ult_usuario,
                                              tipobibliografia)
        SELECT #{id_dct_programa_analitico},
               tipo_referncia,
               autor,
               anio,
               fecha_publicacion,
               titulo,
               edicion,
               titulo_documento,
               lugar,
               editorial,
               volumen,
               numero,
               paginas,
               fecha_consulta,
               url,
               ubicacion,
               id_estado,
               ult_usuario,
               tipobibliografia
        FROM public.prg_a_bibliografia
        where id_dct_programa_analitico = #{id_dct_programa_analitico_ant}
          and id_estado = 'A';
    </insert>


    <select id="GetListarBibliografia" resultType="com.moxos.uab.mybatis.entity.BiBliografia">
        select *
        from prg_a_bibliografia
        where id_dct_programa_analitico = #{id_dct_programa_analitico}
          and id_estado = 'A'
        order by tipobibliografia
    </select>
    <select id="getBibliografia" resultType="com.moxos.uab.mybatis.entity.BiBliografia">
        select *
        from prg_a_bibliografia
        where id_prg_a_bibliografia = #{id_prg_a_bibliografia}
    </select>
    <insert id="registrarBibliografia">
        INSERT INTO public.prg_a_bibliografia(id_dct_programa_analitico, tipo_referncia, autor, anio, fecha_publicacion,
                                              titulo, edicion, titulo_documento, lugar, editorial, volumen, numero,
                                              paginas, fecha_consulta, url, ubicacion, id_estado, ult_usuario,
                                              tipobibliografia)
        VALUES (#{id_dct_programa_analitico}, #{tipo_referncia}, #{autor}, #{anio}, #{fecha_publicacion},
                #{titulo}, #{edicion}, #{titulo_documento}, #{lugar}, #{editorial}, #{volumen}, #{numero}, #{paginas},
                #{fecha_consulta}, #{url}, #{ubicacion}, 'A', 1, #{tipobibliografia});
    </insert>
    <update id="actualizarBibliografia">
        UPDATE public.prg_a_bibliografia
        SET tipo_referncia=#{tipo_referncia},
            autor=#{autor},
            anio=#{anio},
            fecha_publicacion=#{fecha_publicacion},
            titulo=#{titulo},
            edicion=#{edicion},
            titulo_documento=#{titulo_documento},
            lugar=#{lugar},
            editorial=#{editorial},
            volumen=#{volumen},
            numero=#{numero},
            paginas=#{paginas},
            fecha_consulta=#{fecha_consulta},
            url=#{url},
            ubicacion=#{ubicacion},
            tipobibliografia=#{tipobibliografia}
        WHERE id_prg_a_bibliografia = #{id_prg_a_bibliografia};
    </update>
    <update id="eliminarBibliografia">
        UPDATE public.prg_a_bibliografia
        SET id_estado='X'
        WHERE id_prg_a_bibliografia = #{id_prg_a_bibliografia};
    </update>

    <!--Fin Bibliografia -->


    <!-- Cronograma -->
    <resultMap id="map_listarCronograma" type="com.moxos.uab.mybatis.entity.Cronograma">
        <result property="id_prg_a_cronograma" column="id_prg_a_cronograma"/>
        <result property="fecha" column="fecha"/>
        <result property="tipo_de_clase" column="tipo_de_clase"/>
        <result property="titulo_de_clase" column="titulo_de_clase"/>
        <result property="tiempo_a_emplear" column="tiempo_a_emplear"/>
        <result property="observaciones" column="observaciones"/>
    </resultMap>
    <select id="GetListaCopiarCronograma" resultMap="map_listarCronograma">
        SELECT id_prg_a_cronograma, dia_fecha, tipo_de_clase, titulo_de_clase, tiempo_a_emplear, observaciones
        FROM prg_a_cronograma
        WHERE id_estado = 'A'
          and id_dct_programa_analitico = #{id_dct_programa_analitico};
    </select>
    <select id="getListarCronograma" resultType="com.moxos.uab.mybatis.entity.Cronograma">
        select *
        from prg_a_cronograma
        WHERE id_dct_programa_analitico = #{id_dct_programa_analitico}
          and id_estado = 'A'
        order by fecha
    </select>
    <select id="getCronograma" resultType="com.moxos.uab.mybatis.entity.Cronograma">
        select *
        from prg_a_cronograma
        WHERE id_prg_a_cronograma = #{id_prg_a_cronograma};
    </select>
    <insert id="registrarCronograma">
        INSERT INTO public.prg_a_cronograma(id_dct_programa_analitico, tipo_de_clase, titulo_de_clase, tiempo_a_emplear,
                                            observaciones, id_estado, ult_usuario, fecha)
        VALUES (#{id_dct_programa_analitico}, #{tipo_de_clase}, #{titulo_de_clase}, #{tiempo_a_emplear},
                #{observaciones}, 'A', 1, #{fecha});
    </insert>
    <update id="actualizarCronograma">
        UPDATE public.prg_a_cronograma
        SET tipo_de_clase=#{tipo_de_clase},
            titulo_de_clase=#{titulo_de_clase},
            tiempo_a_emplear=#{tiempo_a_emplear},
            observaciones=#{observaciones},
            fecha=#{fecha}
        WHERE id_prg_a_cronograma = #{id_prg_a_cronograma};
    </update>
    <update id="eliminarCronograma">
        UPDATE public.prg_a_cronograma
        SET id_estado='X'
        WHERE id_prg_a_cronograma = #{id_prg_a_cronograma};
    </update>

    <!--Fin Cronograma -->


    <!-- Contenido -->
    <resultMap id="map_listarContenidos" type="com.moxos.uab.mybatis.entity.Contenidos">
        <result property="id_prg_a_contenido" column="id_prg_a_contenido"/>
        <result property="contenido" column="contenido"/>
        <result property="objetivo_instructivo" column="objetivo_instructivo"/>
        <result property="conocimientos" column="conocimientos"/>
        <result property="habilidades" column="habilidades"/>
        <result property="valores" column="valores"/>
        <result property="mapa" column="mapa"/>
    </resultMap>
    <select id="GetListaCopiarContenidos" resultMap="map_listarContenidos">
        SELECT id_prg_a_contenido, contenido, objetivo_instructivo, conocimientos, habilidades, valores, mapa
        FROM prg_a_contenido
        WHERE id_estado = 'A'
          and id_dct_programa_analitico = #{id_dct_programa_analitico}
        order by id_prg_a_contenido
    </select>
    <select id="GetListarContenido" resultMap="map_listarContenidos">
        select *
        from mi_dct_listar_pgr_objetivo_instructivo(#{id_dct_programa_analitico}) as (
        id_prg_a_contenido integer,
        contenido dtexto,
        objetivo_instructivo dtexto,
        conocimientos dtexto,
        habilidades dtexto,
        valores dtexto,
        mapa dimagen
        )
    </select>
    <resultMap id="map_detalleContenidos" type="com.moxos.uab.mybatis.entity.Contenidos">
        <result property="id_prg_a_contenido" column="id_prg_a_contenido"/>
        <result property="contenido" column="contenido"/>
        <result property="objetivo_instructivo" column="objetivo_instructivo"/>
        <result property="conocimientos" column="conocimientos"/>
        <result property="habilidades" column="habilidades"/>
        <result property="valores" column="valores"/>
        <result property="mapa" column="mapa"/>
        <result property="id_dct_programa_analitico" column="id_dct_programa_analitico"/>
    </resultMap>
    <select id="getContenido" resultMap="map_detalleContenidos">
        SELECT id_dct_programa_analitico,
               id_prg_a_contenido,
               contenido,
               objetivo_instructivo,
               conocimientos,
               habilidades,
               valores,
               mapa
        FROM prg_a_contenido
        WHERE id_estado = 'A'
          AND id_prg_a_contenido = #{id_prg_a_contenido};
    </select>
    <select id="RegistrarObjetivo_Instructivo_mapa" resultType="java.lang.Integer">
        select *
        from mi_dct_registrar_prg_a_objetivo_instructivo_mapa(#{id_dct_programa_analitico}, #{contenido},
                                                              #{objetivo_instructivo}, #{conocimientos}, #{habilidades},
                                                              #{valores}, #{mapa}, #{ult_usuario});
    </select>
    <select id="RegistrarObjetivo_Instructivo" resultType="java.lang.Integer">
        select *
        from mi_dct_registrar_prg_a_objetivo_instructivo(#{id_dct_programa_analitico}, #{contenido},
                                                         #{objetivo_instructivo}, #{conocimientos}, #{habilidades},
                                                         #{valores}, #{ult_usuario});
    </select>
    <update id="ActualizarMapaContenido">
        UPDATE prg_a_contenido
        SET mapa=#{mapa}
        WHERE id_prg_a_contenido = #{id_prg_a_contenido};
    </update>
    <select id="ActualizarObjetivo_Instructivo" resultType="java.lang.Integer">
        select *
        from mi_dct_actualizar_prg_a_objetivo_instructivo(#{id_prg_a_contenido}, #{contenido},
                                                          #{objetivo_instructivo}, #{conocimientos}, #{habilidades},
                                                          #{valores}, #{ult_usuario});
    </select>
    <select id="EliminarObjetivo_Instructivo" resultType="java.lang.Integer">
        select *
        from mi_dct_eliminar_prg_a_objetivo_instructivo(#{id_prg_a_contenido})
    </select>

    <!--Fin Cronograma -->

    <!--formas de organizacion -->
    <insert id="copyDistribucion">
        INSERT INTO public.prg_a_distribucion(id_dct_programa_analitico, id_prg_a_contenido, id_prg_a_formas, horas,
                                              id_estado, ult_usuario)
        SELECT #{id_dct_programa_analitico}, #{id_prg_a_contenido}, id_prg_a_formas, horas, id_estado, ult_usuario
        FROM public.prg_a_distribucion
        WHERE id_prg_a_contenido = #{id_prg_a_contenido_ant}
          AND id_estado = 'A';
    </insert>

    <resultMap id="map_listarformasprogramaanalitico" type="com.moxos.uab.mybatis.entity.FormasOrganizacion">
        <result property="id_prg_a_formas" column="id_prg_a_formas"/>
        <result property="sigla_formas" column="sigla_formas"/>
        <result property="formas" column="formas"/>
    </resultMap>
    <resultMap id="map_listarformas" type="com.moxos.uab.mybatis.entity.FormasOrganizacion">
        <result property="id_prg_a_formas" column="id_prg_a_formas"/>
        <result property="sigla_formas" column="sigla_formas"/>
        <result property="formas" column="formas"/>
    </resultMap>
    <select id="GetListarformas" resultMap="map_listarformas">
        select *
        from mi_dct_listar_pgr_formas_organizacion() as (id_prg_a_formas int4, sigla_formas dtexto, formas
        dtexto);
    </select>
    <resultMap id="map_listarformascontenido" type="com.moxos.uab.mybatis.entity.Contenidos">
        <result property="id_prg_a_contenido" column="id_prg_a_contenido"/>
        <result property="contenido" column="contenido"/>
    </resultMap>
    <select id="GetListarformascontenido" resultMap="map_listarformascontenido">
        select *
        from mi_dct_listar_pgr_formas_Contenido(#{id_dct_programa_analitico}) as (id_prg_a_contenido int4,
        contenido dtexto);
    </select>
    <resultMap id="map_listarprg_a_distribucion" type="com.moxos.uab.mybatis.entity.FormasDistribucion">
        <result property="id_prg_a_distribucion" column="id_prg_a_distribucion"/>
        <result property="id_dct_programa_analitico" column="id_dct_programa_analitico"/>
        <result property="id_prg_a_contenido" column="id_prg_a_contenido"/>
        <result property="id_prg_a_formas" column="id_prg_a_formas"/>
        <result property="horas" column="horas"/>
        <result property="id_estado" column="id_estado"/>
        <result property="ult_usuario" column="ult_usuario"/>
    </resultMap>
    <select id="GetListaCopiarDistribucion" resultMap="map_listarprg_a_distribucion">
        SELECT id_prg_a_distribucion,
               id_dct_programa_analitico,
               id_prg_a_contenido,
               id_prg_a_formas,
               horas,
               id_estado,
               ult_usuario
        FROM public.prg_a_distribucion
        WHERE id_estado = 'A'
          and id_dct_programa_analitico = #{id_dct_programa_analitico}
          and id_prg_a_contenido = #{id_prg_a_contenido};
    </select>
    <resultMap id="map_detalle_formas_distribucion" type="com.moxos.uab.mybatis.entity.FormasDistribucion">
        <result property="id_prg_a_formas" column="id_prg_a_formas"/>
        <result property="horas" column="horas"/>
    </resultMap>
    <select id="RegistrarFormasDistribucion" resultType="java.lang.Integer">
        select *
        from mi_dct_registrar_prg_a_formas_distribucion(#{id_prg_a_distribucion}, #{id_prg_a_formas}, #{horas},
                                                        #{ult_usuario});
    </select>
    <select id="ActualizarFormasDistribucion" resultType="java.lang.Integer">
        select *
        from mi_dct_actualizar_prg_a_formas_distribucion(#{id_prg_a_formas_distribucion}, #{id_prg_a_formas},
                                                         #{horas}, #{ult_usuario});
    </select>
    <select id="EliminarFormasDistribucion" resultType="java.lang.Integer">
        select *
        from mi_dct_eliminar_prg_a_formas_distribucion(#{id_prg_a_formas_distribucion});
    </select>
    <!--Fin formas de organizacion -->
    <resultMap id="map_listarprogramas" type="com.moxos.uab.mybatis.entity.ListViewItem">
        <result property="id" column="id"/>
        <result property="value" column="value"/>
    </resultMap>
    <select id="GetListarProgramasAnaliticosPorMateria" resultMap="map_listarprogramas">
        SELECT dp.id_dct_programa_analitico as id,
               m.sigla || ' - ' || m.materia || ' ' || g.grupo || ' ' || periodo || '/' || gestion as value
        FROM dct_programa_analitico as dp inner join materias as m
        on dp.id_materia= m.id_materia inner join
            grupos as g on g.id_grupo = dp.id_grupo
        where dp.id_grupo=#{id_grupo}
          and dp.id_estado='A'
          and dp.id_materia=#{id_materia}
          and dp.id_plan=#{id_plan}
        ORDER BY gestion desc, periodo desc
    </select>
    <resultMap id="map_formas_distribucion" type="com.moxos.uab.mybatis.entity.FormasOrganizacionDistribucion">
        <result property="id_prg_a_formas" column="id_prg_a_formas"/>
        <result property="id_prg_a_contenido" column="id_prg_a_contenido"/>
        <result property="sigla_formas" column="sigla_formas"/>
        <result property="horas" column="horas"/>
        <result property="id_prg_a_distribucion" column="id_prg_a_distribucion"/>
    </resultMap>
    <select id="getListarFormasOrganizacionDistribucion" resultMap="map_formas_distribucion">
        SELECT pd.id_prg_a_formas, pd.id_prg_a_contenido, pf.sigla_formas, pd.horas, pd.id_prg_a_distribucion
        from prg_a_distribucion pd
                 INNER JOIN prg_a_formas pf on pf.id_prg_a_formas = pd.id_prg_a_formas
                 INNER JOIN prg_a_contenido pc on pc.id_prg_a_contenido = pd.id_prg_a_contenido
        where pd.id_dct_programa_analitico = #{id_dct_programa_analitico}
          and pc.id_estado = 'A'
          AND pd.id_estado = 'A'
    </select>
    <select id="getListarFormasOrganizacionDistribucionCopiar" resultMap="map_listarprg_a_distribucion">
        SELECT id_prg_a_distribucion,
               id_dct_programa_analitico,
               id_prg_a_contenido,
               id_prg_a_formas,
               horas,
               id_estado,
               ult_usuario
        FROM public.prg_a_distribucion
        WHERE id_estado = 'A'
          and id_prg_a_contenido = #{id_prg_a_contenido};
    </select>
    <resultMap id="map_listar_formas" type="com.moxos.uab.mybatis.entity.FormasOrganizacion">
        <result property="id_prg_a_formas" column="id_prg_a_formas"/>
        <result property="grupo_forma" column="grupo_forma"/>
        <result property="formas" column="formas"/>
    </resultMap>
    <select id="getListaFormasPorTipo" resultMap="map_listar_formas">
        SELECT id_prg_a_formas, grupo_forma, sigla_formas || ' - ' || formas as formas
        FROM prg_a_formas
        where tipo_forma = #{tipo_forma}
        order by grupo_forma
    </select>
    <select id="getFormasDistribucion" resultType="com.moxos.uab.mybatis.entity.FormasDistribucion">
        SELECT *
        FROM prg_a_distribucion
        where id_prg_a_distribucion = #{id_prg_a_distribucion}
    </select>
    <resultMap id="map_formas_por_distribucion" type="com.moxos.uab.mybatis.entity.FormasOrganizacionDistribucion">
        <result property="id_prg_a_formas" column="id_prg_a_formas"/>
        <result property="sigla_formas" column="sigla_formas"/>
    </resultMap>
    <select id="getListarFormasPorDistribucion" resultMap="map_formas_por_distribucion">
        SELECT DISTINCT pd.id_prg_a_formas, pf.sigla_formas
        from prg_a_distribucion pd
                 INNER JOIN prg_a_formas pf on pf.id_prg_a_formas = pd.id_prg_a_formas
                 INNER JOIN prg_a_contenido pc on pc.id_prg_a_contenido = pd.id_prg_a_contenido
        where pd.id_dct_programa_analitico = #{id_dct_programa_analitico}
          and pc.id_estado = 'A'
          and pd.id_estado = 'A'
    </select>
    <select id="getidDistribucion" resultType="java.lang.Integer">
        SELECT id_prg_a_distribucion
        from prg_a_distribucion
        where id_dct_programa_analitico = #{id_dct_programa_analitico}
          and id_prg_a_formas = #{id_prg_a_formas}
          and id_prg_a_contenido = #{id_prg_a_contenido}
          AND id_estado = 'A'
    </select>
    <select id="getTotalHorasdistribucion" resultType="java.lang.Integer">
        SELECT sum(pd.horas)
        from prg_a_contenido pc
                 INNER JOIN prg_a_distribucion pd on pc.id_prg_a_contenido = pd.id_prg_a_contenido
        where pc.id_estado = 'A'
          AND pd.id_dct_programa_analitico = #{id_dct_programa_analitico}
          AND pd.id_estado = 'A'
    </select>
    <insert id="insertarDistribucion">
        INSERT INTO public.prg_a_distribucion(id_dct_programa_analitico, id_prg_a_contenido, id_prg_a_formas, horas,
                                              id_estado, ult_usuario)
        VALUES (#{id_dct_programa_analitico}, #{id_prg_a_contenido}, #{id_prg_a_formas}, #{horas}, 'A', 1);
    </insert>
    <update id="actualizarHorasDistribucion">
        UPDATE public.prg_a_distribucion
        SET horas=#{horas},
            ult_usuario=1
        WHERE id_prg_a_distribucion = #{id_prg_a_distribucion};
    </update>
    <update id="eliminarDistribucion">
        UPDATE public.prg_a_distribucion
        SET id_estado='X'
        WHERE id_prg_a_distribucion = #{id_prg_a_distribucion};
    </update>
    <resultMap id="map_materias_horas" type="com.moxos.uab.mybatis.entity.HorasMaterias">
        <result property="hrs_teoricas" column="hrs_teoricas"/>
        <result property="hrs_practicas" column="hrs_practicas"/>
        <result property="total" column="total"/>
        <result property="totalsemana" column="totalsemana"/>
        <result property="programa" column="programa"/>
        <result property="tipo_materia" column="tipo_materia"/>
    </resultMap>
    <select id="getCantidadHorasAsignatura" resultMap="map_materias_horas">
        SELECT mt.hrs_teoricas,
               mt.hrs_practicas,
               mt.hrs_teoricas + mt.hrs_practicas                     as totalsemana,
               case
                   when mmt.id_tipo_materia = 1 then (mt.hrs_teoricas + mt.hrs_practicas) * 20
                   else (mt.hrs_teoricas + mt.hrs_practicas) * 40 end as total,
               fp.programa,
               mmt.tipo_materia
        from dct_programa_analitico da
                 INNER JOIN materias mt on mt.id_materia = da.id_materia
                 INNER JOIN fcl_departamentos_programas fdp on mt.id_departamento = fdp.id_departamento
                 INNER JOIN fcl_programas fp on fdp.id_programa = fp.id_programa
                 INNER JOIN fcl_tipo_programa ftp on fp.id_programa = ftp.id_programa
                 INNER JOIN mtr_tipos_materias mmt on mmt.id_tipo_materia = ftp.id_tipo_materia
        where da.id_dct_programa_analitico = #{id_dct_programa_analitico} limit 1
    </select>
    <resultMap id="map_formas_clases" type="com.moxos.uab.mybatis.entity.ListViewItem">
        <result property="id" column="id"/>
        <result property="value" column="value"/>
    </resultMap>
    <select id="getListaFormasClases" resultMap="map_formas_clases">
        select sigla_formas as id, sigla_formas || ' - ' || formas as value
        from public.prg_a_formas
    </select>
    <resultMap id="map_tipo_formas_organizacion" type="com.moxos.uab.mybatis.entity.FormasOrganizacion">
        <result property="grupo_forma" column="grupo_forma"/>
        <result property="sigla_formas" column="sigla_formas"/>
        <result property="tipo_forma" column="tipo_forma"/>
        <result property="formas" column="formas"/>
    </resultMap>
    <select id="getListaFormarPorProgramaYTipoPresencial" resultMap="map_tipo_formas_organizacion">
        SELECT DISTINCT pf.grupo_forma, pf.sigla_formas, pf.tipo_forma, pf.formas
        from prg_a_distribucion pd
                 INNER JOIN prg_a_formas pf on pf.id_prg_a_formas = pd.id_prg_a_formas
                 INNER JOIN prg_a_contenido pc on pc.id_prg_a_contenido = pd.id_prg_a_contenido
        where pd.id_dct_programa_analitico = ${id_dct_programa_analitico}
          and pc.id_estado = 'A'
          and pd.id_estado = 'A'
          and pd.horas!=0
          and pf.tipo_forma = 'PRESENCIAL'
    </select>
    <select id="getListaFormarPorProgramaYTipoVirtual" resultMap="map_tipo_formas_organizacion">
        SELECT DISTINCT pf.grupo_forma, pf.sigla_formas, pf.tipo_forma, pf.formas
        from prg_a_distribucion pd
                 INNER JOIN prg_a_formas pf on pf.id_prg_a_formas = pd.id_prg_a_formas
                 INNER JOIN prg_a_contenido pc on pc.id_prg_a_contenido = pd.id_prg_a_contenido
        where pd.id_dct_programa_analitico = ${id_dct_programa_analitico}
          and pc.id_estado = 'A'
          and pd.id_estado = 'A'
          and pd.horas!=0
          and pf.tipo_forma = 'VIRTUAL DISTANCIA'
    </select>
</mapper>
